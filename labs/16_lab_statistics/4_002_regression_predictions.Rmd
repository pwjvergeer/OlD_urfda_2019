---
title: "Regression and Predictions"
author: "Marc A.T. Teunis"
date: "`r Sys.Date()`"
output:
  html_document:
  ioslides_presentation: 
    highlight: pygments
    widescreen: yes
---
<style>

.footer {
    font-size: 16pt;
    color: Black;
    font-family: 'Helvetica'
    content: attr(label);
    position: absolute;
    margin-left: auto;
    margin-right: auto;
    left: 0;
    right: 0;
    text-align:center;
    bottom: 10px;
    line-height: 1.9;
    display: block;
}

</style>

<div class="footer" style="margin-top;font-size:120%;"> 
Data Analysis Using R - November 2017 </div>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 10, fig.height = 8,
                      warning = FALSE,
                      error = FALSE,
                      message = FALSE)
```

```{r, root_1, include=FALSE}
## defines the root of the project for later use
require("rprojroot") || utils::install.packages("rprojroot")
library(rprojroot)
root <- find_root_file(criterion = is_rstudio_project)
```

## References and sources

R Code for Chapter 13 of:
Field, A. P., Miles, J. N. V., & Field, Z. C. (2012). Discovering Statistics Using R: and Sex and Drugs and Rock 'N' Roll. 
London Sage
(c) 2011 Andy P. Field, Jeremy N. V. Miles & Zoe C. Field

## Install packages
```{r}
# install.packages("compute.es")
# install.packages("ez")
# install.packages("ggplot2")
# install.packages("multcomp")
# install.packages("nlme")
# install.packages("pastecs")
# install.packages("reshape")
# install.packages("WRS", repos="http://R-Forge.R-project.org")
# install.packages("akima")

#Initiate packages
library(tidyverse)
library(compute.es)
library(ez)
library(ggplot2)
library(multcomp)
library(nlme)
library(pastecs)
library(reshape)
library(WRS)
## source("http://www-rcf.usc.edu/~rwilcox/Rallfun-v14")
```

```{r}


set.seed(123)

x <- 1:10
y <- -2 + 3 * x + rnorm(10)
our_data <- data.frame(dv = y, iv = x)
our_model <- lm(dv ~ iv, data = our_data)

new <- c(10:20)
new_dv <- predict(our_model, newdata =  data.frame(iv = new))
new_data <- tibble(dv = as.numeric(new_dv), iv = new)

our_data %>% 
ggplot(aes(x = iv, y = dv)) +
  geom_point() +
  geom_smooth(method = "lm") +
  geom_point(data = new_data, colour = "red") +
  geom_line(data = new_data, colour = "red")



```

## A more complucated extrapolation 
Using the ENZA data to make predictions





```{r}

x <- rnorm(15)
y <- x + rnorm(15)
predict(lm(y ~ x))
new <- data.frame(x = seq(-3, 3, 0.5))
predict(lm(y ~ x), new, se.fit = TRUE)
pred.w.plim <- predict(lm(y ~ x), new, interval = "prediction")
pred.w.clim <- predict(lm(y ~ x), new, interval = "confidence")
matplot(new$x, cbind(pred.w.clim, pred.w.plim[,-1]),
        lty = c(1,2,2,3,3), type = "l", ylab = "predicted y")

##-- From  aov(.) example ---- predict(.. terms)
npk.aov <- aov(yield ~ block + N*P*K, npk)
(termL <- attr(terms(npk.aov), "term.labels"))
(pt <- predict(npk.aov, type = "terms"))
pt. <- predict(npk.aov, type = "terms", terms = termL[1:4])
stopifnot(all.equal(pt[,1:4], pt.,
                    tolerance = 1e-12, check.attributes = FALSE))




```